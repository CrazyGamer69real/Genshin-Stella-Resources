; kirara

; Constants -------------------------

[Constants]
global $active = 0
global $creditinfo = 0
global $CharacterIB
;0=none, 1=head, 2=body, 3=dress, 4=extra, etc.

[Present]
post $active = 0
run = CommandListCreditInfo
post $CharacterIB = 0
[ResourceRefHeadDiffuse]
[ResourceRefHeadLightMap]
[ResourceRefBodyDiffuse]
[ResourceRefBodyLightMap]
[ResourceRefDressDiffuse]
[ResourceRefDressLightMap]
[ResourceRefExtraDiffuse]
[ResourceRefExtraLightMap]

; Overrides -------------------------

[TextureOverridekiraraPosition]
hash = cc833025
vb0 = ResourcekiraraPosition
$active = 1

[TextureOverridekiraraBlend]
hash = 01d54938
vb1 = ResourcekiraraBlend
handling = skip
draw = 21094,0 

[TextureOverridekiraraTexcoord]
hash = 33b3d6e5
vb1 = ResourcekiraraTexcoord

[TextureOverridekiraraVertexLimitRaise]
hash = e656b9fd

[TextureOverridekiraraIB]
hash = ce3dc5a2
handling = skip
drawindexed = auto

[TextureOverridekiraraHead]
hash = ce3dc5a2
match_first_index = 0
ib = ResourcekiraraHeadIB
ps-t0 = ResourcekiraraHeadNormalMap
ps-t1 = ResourcekiraraHeadDiffuse
ps-t2 = ResourcekiraraHeadLightMap
$CharacterIB = 1
ResourceRefHeadDiffuse = reference ps-t1
ResourceRefHeadLightMap = reference ps-t2

[TextureOverridekiraraBody]
hash = ce3dc5a2
match_first_index = 37128
ib = ResourcekiraraBodyIB
ps-t0 = ResourcekiraraBodyNormalMap
ps-t1 = ResourcekiraraBodyDiffuse
ps-t2 = ResourcekiraraBodyLightMap
$CharacterIB = 2
ResourceRefBodyDiffuse = reference ps-t1
ResourceRefBodyLightMap = reference ps-t2

[TextureOverridekiraraDress]
hash = ce3dc5a2
match_first_index = 75234
ib = ResourcekiraraDressIB
ps-t0 = ResourcekiraraDressNormalMap
ps-t1 = ResourcekiraraDressDiffuse
ps-t2 = ResourcekiraraDressLightMap
$CharacterIB = 3
ResourceRefDressDiffuse = reference ps-t1
ResourceRefDressLightMap = reference ps-t2

; CommandList -----------------------

[CommandListCreditInfo]
if $creditinfo == 1 && $active == 1
	pre Resource\ShaderFixes\help.ini\Notification = ResourceCreditInfo
	pre run = CustomShader\ShaderFixes\help.ini\FormatText
	pre $\ShaderFixes\help.ini\notification_timeout = time + 5.0
endif

[CommandListReflectionTexture]
if $CharacterIB != 0
    if $CharacterIB == 1
        ps-t0 = copy ResourceRefHeadDiffuse
    else if $CharacterIB == 2
        ps-t0 = copy ResourceRefBodyDiffuse
    else if $CharacterIB == 3
        ps-t0 = copy ResourceRefDressDiffuse
    else if $CharacterIB == 4
        ps-t0 = copy ResourceRefExtraDiffuse    
    endif
drawindexed=auto
$CharacterIB = 0
endif

[CommandListOutline]
if $CharacterIB != 0
    if $CharacterIB == 1
        ps-t1 = copy ResourceRefHeadLightMap
    else if $CharacterIB == 2
        ps-t1 = copy ResourceRefBodyLightMap
    else if $CharacterIB == 3
        ps-t1 = copy ResourceRefDressLightMap
    else if $CharacterIB == 4
        ps-t1 = copy ResourceRefExtraLightMap
    endif
drawindexed=auto
$CharacterIB = 0
endif

; ShaderOverride ---------------------------

[ShaderRegexCharReflection]
shader_model = ps_5_0
run = CommandListReflectionTexture
[ShaderRegexCharReflection.pattern]
mul r\d+\.\w+, r\d+\.\w+,[^.]*\.\w+\n
mad o\d+\.\w+, r\d+\.\w+, cb\d+\[\d+\]\.\w+, r\d+\.\w+\n
mov o\d+\.\w+, l\(\d+\.\d+\)\n

[ShaderRegexCharOutline]
shader_model = ps_5_0
run = CommandListOutline
[ShaderRegexCharOutline.pattern]
mov o\d+\.\w+, l\(\d+\)\n
mov o\d+\.\w+, r\d+\.\w+\n
mov o\d+\.\w+, l\(\d+\.\d+\)

; Resources -------------------------

[ResourcekiraraPosition]
type = Buffer
stride = 40
filename = kiraraPosition.buf

[ResourcekiraraBlend]
type = Buffer
stride = 32
filename = kiraraBlend.buf

[ResourcekiraraTexcoord]
type = Buffer
stride = 20
filename = kiraraTexcoord.buf

[ResourcekiraraHeadIB]
type = Buffer
format = DXGI_FORMAT_R32_UINT
filename = kiraraHead.ib

[ResourcekiraraBodyIB]
type = Buffer
format = DXGI_FORMAT_R32_UINT
filename = kiraraBody.ib

[ResourcekiraraDressIB]
type = Buffer
format = DXGI_FORMAT_R32_UINT
filename = kiraraDress.ib

[ResourcekiraraHeadNormalMap]
filename = kiraraHeadNormalMap.dds

[ResourcekiraraHeadDiffuse]
filename = kiraraHeadDiffuse.dds

[ResourcekiraraHeadLightMap]
filename = kiraraHeadLightMap.dds

[ResourcekiraraBodyNormalMap]
filename = kiraraBodyNormalMap.dds

[ResourcekiraraBodyDiffuse]
filename = kiraraBodyDiffuse.dds

[ResourcekiraraBodyLightMap]
filename = kiraraBodyLightMap.dds

[ResourcekiraraDressNormalMap]
filename = kiraraDressNormalMap.dds

[ResourcekiraraDressDiffuse]
filename = kiraraDressDiffuse.dds

[ResourcekiraraDressLightMap]
filename = kiraraDressLightMap.dds

[ResourceCreditInfo]
type = Buffer
data = "Created by RDragona"


; .ini generated by GIMI (Genshin-Impact-Model-Importer)
; If you have any issues or find any bugs, please open a ticket at https://github.com/SilentNightSound/GI-Model-Importer/issues or contact SilentNightSound#7430 on discord